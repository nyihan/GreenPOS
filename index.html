<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ko Nyi POS</title>
    <meta name="theme-color" content="#43a047">

    <link rel="manifest" href="manifest.json">

    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        :root { --primary: #43a047; --primary-dark: #2e7d32; --bg: #f5f5f5; --text: #212121; --white: #ffffff; --accent: #ff9800; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Pyidaungsu", sans-serif; background: var(--bg); color: var(--text); margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* HEADER */
        .header { background: var(--primary); color: white; height: 56px; display: flex; align-items: center; padding: 0 16px; justify-content: space-between; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 50; flex-shrink: 0; }
        .menu-btn { font-size: 20px; cursor: pointer; padding: 10px; }
        .header-title-area { display: flex; align-items: center; gap: 10px; cursor: pointer; flex: 1; }
        .header-title { font-size: 18px; font-weight: bold; }
        .ticket-badge { background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 4px; font-size: 13px; font-weight: bold; display: none; }

        /* SIDEBAR (Drawer) */
        .drawer-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 99; display: none; }
        .drawer-backdrop.open { display: block; }
        .drawer { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background: white; z-index: 100; transition: 0.3s; display: flex; flex-direction: column; }
        .drawer.open { left: 0; }
        .drawer-head { background: var(--primary); height: 120px; padding: 20px; color: white; display: flex; flex-direction: column; justify-content: flex-end; }
        .drawer-list { flex: 1; overflow-y: auto; padding-top: 10px; }
        .drawer-item { padding: 16px 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 15px; cursor: pointer; color: #444; font-weight: 500; }
        .drawer-item.active { background: #e8f5e9; color: var(--primary); }
        .drawer-foot { padding: 15px; text-align: center; font-size: 11px; color: #999; border-top: 1px solid #eee; }

        /* TOP NAV */
        .top { background: var(--primary); color: white; height: 56px; display: flex; align-items: center; padding: 0 10px; gap: 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 50; flex-shrink: 0; }
        .top-btn { background: none; border: none; color: white; font-size: 20px; cursor: pointer; padding: 8px; }
        .top-title { font-size: 18px; font-weight: bold; line-height: 1.2; }
        .top-sub { font-size: 12px; opacity: 0.8; }

        /* SCREENS */
        .content { flex: 1; overflow: hidden; position: relative; display: flex; flex-direction: column; }
        .screen { display: none; flex-direction: column; height: 100%; width: 100%; }
        .screen.active { display: flex; }

        /* POS LAYOUT */
        .pos-top { padding: 10px; background: white; border-bottom: 1px solid #eee; display: flex; gap: 10px; align-items: center; }
        #filterCat { border: 1px solid #ddd; padding: 8px; border-radius: 4px; background: white; max-width: 120px; }
        
        .search-wrap { flex: 1; display: flex; align-items: center; background: #f1f1f1; border-radius: 4px; padding: 0 5px; border: 1px solid #ddd; }
        .search-input { flex: 1; padding: 8px; border: none; background: transparent; outline: none; }
        .barcode-btn { background: none; border: none; color: #555; font-size: 18px; padding: 8px 12px; cursor: pointer; border-left: 1px solid #ddd; }
        .barcode-btn:active { color: var(--primary); background: #e0e0e0; }

        .pos-main { flex: 1; display: flex; overflow: hidden; background: #f0f2f5; }
        .grid { flex: 1; padding: 10px; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; align-content: flex-start; }
        
        /* Product Card */
        .p-card { background: white; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); overflow: hidden; cursor: pointer; display: flex; flex-direction: column; height: 110px; border: 1px solid #eee; }
        .p-card:active { transform: scale(0.98); }
        .p-strip { height: 6px; }
        .p-name { font-size: 13px; font-weight: 500; padding: 8px; flex: 1; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; line-height: 1.3; }
        .p-cat { font-size: 10px; color: #888; padding: 0 8px; }
        .p-price { font-size: 13px; font-weight: bold; color: var(--primary); padding: 5px 8px 8px; text-align: right; }

        /* Ticket Side (Mobile: Bottom Sheet style) */
        .ticket-wrap { width: 35%; max-width: 300px; background: white; border-left: 1px solid #ddd; display: flex; flex-direction: column; }
        @media (max-width: 600px) {
           .ticket-wrap { display: none; } /* On very small screens, hide ticket list or make it a drawer? For now let's keep it simple or hide it. 
           Wait, user wants to see ticket. Let's make it 30% width. */
        }

        .ticket { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .ticket-head { padding: 10px; background: #f9f9f9; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; font-weight: bold; font-size: 14px; }
        .ticket-list { flex: 1; overflow-y: auto; padding: 0; }
        .ticket-empty { padding: 20px; text-align: center; color: #999; font-size: 13px; font-style: italic; }
        
        .t-row { padding: 8px 10px; border-bottom: 1px solid #f5f5f5; display: flex; justify-content: space-between; align-items: flex-start; }
        .t-name { font-size: 13px; font-weight: 500; margin-bottom: 4px; }
        .t-meta { font-size: 11px; color: #666; }
        .t-amt { font-weight: bold; font-size: 13px; }
        .qty { display: flex; align-items: center; background: #f0f0f0; border-radius: 12px; margin-top: 4px; width: fit-content; }
        .qty-btn { border: none; background: none; padding: 2px 8px; font-size: 14px; cursor: pointer; color: #555; }
        .qty-val { font-size: 12px; font-weight: bold; min-width: 16px; text-align: center; }

        .charge-bar { height: 60px; background: var(--primary); color: white; display: flex; align-items: center; padding: 0; cursor: pointer; box-shadow: 0 -2px 5px rgba(0,0,0,0.1); z-index: 20; }
        .charge-info { flex: 1; padding-left: 15px; }
        .btn-main { background: rgba(0,0,0,0.1); border: none; color: white; height: 100%; padding: 0 25px; font-size: 16px; font-weight: bold; cursor: pointer; margin-left: auto; }
        .btn-main:active { background: rgba(0,0,0,0.2); }

        /* ITEMS / LISTS */
        .card { background: white; margin: 10px; padding: 10px; border-radius: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); flex: 1; overflow-y: auto; display: flex; flex-direction: column; }
        .s-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; padding: 5px; }
        .hint { font-size: 12px; color: #888; }
        .btn-outline { border: 1px solid var(--primary); color: var(--primary); background: white; padding: 6px 12px; border-radius: 4px; font-size: 13px; cursor: pointer; }
        
        .row-item, .row-cat, .row-rec { padding: 12px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; cursor: pointer; }
        .row-item:last-child { border: none; }
        .row-title { font-weight: 500; font-size: 14px; margin-bottom: 2px; }
        .chip { background: #eee; padding: 2px 6px; border-radius: 4px; font-size: 10px; color: #555; margin-right: 5px; }
        .right { text-align: right; font-size: 12px; }

        /* TABS */
        .tab { display: flex; border-bottom: 1px solid #ddd; background: white; }
        .tab button { flex: 1; padding: 12px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-weight: 500; color: #666; }
        .tab button.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* OVERLAYS / FORMS */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; display: none; justify-content: center; align-items: flex-end; }
        .overlay.show { display: flex; }
        .ov-panel { background: white; width: 100%; max-width: 500px; border-radius: 12px 12px 0 0; display: flex; flex-direction: column; max-height: 90vh; animation: slideUp 0.2s; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .ov-head { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .ov-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #888; }
        .ov-body { padding: 20px; overflow-y: auto; flex: 1; }
        .ov-foot { padding: 15px; border-top: 1px solid #eee; display: flex; justify-content: flex-end; gap: 10px; }
        
        .form .fg { margin-bottom: 15px; }
        .form label { display: block; font-size: 12px; font-weight: bold; color: #666; margin-bottom: 5px; }
        .form input, .form select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 15px; box-sizing: border-box; }
        .form input:focus { border-color: var(--primary); outline: none; }
        .form-row { display: flex; gap: 10px; }
        .form-row .fg { flex: 1; }
        
        .btn { padding: 10px 20px; border-radius: 4px; border: none; font-weight: bold; cursor: pointer; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-danger { background: #e53935; color: white; }
        .btn-ghost { background: #eee; color: #333; }

        /* TOAST */
        .toast { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); background: #323232; color: white; padding: 10px 20px; border-radius: 50px; font-size: 13px; z-index: 1000; opacity: 0; pointer-events: none; transition: 0.3s; white-space: nowrap; }
        .toast.show { opacity: 1; bottom: 100px; }

        /* SCANNER */
        #scanner-view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 300; display: none; flex-direction: column; justify-content: center; }
        .close-scan { position: absolute; top: 20px; right: 20px; color: white; font-size: 30px; cursor: pointer; z-index: 301; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body>
<div class="app">
  <div id="drawerBackdrop" class="drawer-backdrop"></div>
  <div id="drawer" class="drawer">
    <div class="drawer-head">
      <b style="font-size:18px">GreenPOS</b><br><small>Google Sheets â€¢ Ks</small>
    </div>
    <div class="drawer-list">
      <div class="drawer-item active" data-screen="pos"><i class="fa-solid fa-cash-register"></i>POS (Sales)</div>
      <div class="drawer-item" data-screen="items"><i class="fa-solid fa-boxes-stacked"></i>Items</div>
      <div class="drawer-item" data-screen="receipts"><i class="fa-solid fa-receipt"></i>Receipts</div>
      <div class="drawer-item" id="navExit"><i class="fa-solid fa-right-from-bracket"></i>Exit</div>
    </div>
    <div class="drawer-foot">Connected to Google Sheets</div>
  </div>

  <div class="top">
    <button id="btnMenu" class="top-btn"><i class="fa-solid fa-bars"></i></button>
    <div>
      <div id="topTitle" class="top-title">Ticket</div>
      <div id="topSub" class="top-sub">POS</div>
    </div>
  </div>

  <div class="content">
    <div id="scr-pos" class="screen active">
      <div class="pos-top">
        <select id="filterCat">
          <option value="">All</option>
        </select>
        <div class="search-wrap">
          <input id="txtSearch" class="search-input" placeholder="Search / barcode" />
          <button id="btnScan" class="barcode-btn"><i class="fa-solid fa-barcode"></i></button>
        </div>
      </div>
      
      <div class="pos-main">
        <div id="gridItems" class="grid"></div>
        
        <div class="ticket-wrap" style="display:none" id="ticketPanel">
             </div>
      </div>

      
